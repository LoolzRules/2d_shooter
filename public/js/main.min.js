!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";n.r(t),n.d(t,"Body",function(){return r}),n.d(t,"BodyEnum",function(){return o});var r=function(){function e(e,t,n){this.armor=e,this.speedModifier=t,this.textureKey=n}return e.makeBody=function(t,n,r){void 0===r&&(r=0);var o=new e(t.armor,t.speedModifier,t.textureKey);return o.setSprite(r,n),o},e.prototype.setSprite=function(e,t){this._sprite=t.add.sprite(10,0,this.textureKey[e])},Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),e}(),o=new Map([["NONE",{armor:0,speedModifier:1,textureKey:["b_none_1","b_none_2"]}],["LIGHT",{armor:1,speedModifier:.9,textureKey:["b_light_1","b_light_2"]}],["HEAVY",{armor:2,speedModifier:.8,textureKey:["b_heavy_1","b_heavy_2"]}]])},function(e,t,n){"use strict";n.r(t),n.d(t,"Head",function(){return r}),n.d(t,"HeadEnum",function(){return o});var r=function(){function e(e,t,n){this.armor=e,this.fov=t,this.textureKey=n}return e.makeHead=function(t,n){var r=new e(t.armor,t.fov,t.textureKey);return r._sprite=n.add.sprite(-5,-5,r.textureKey),r},Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),e}(),o=new Map([["NONE",{armor:0,fov:120,textureKey:"h_none"}],["GAS_MASK",{armor:0,fov:60,textureKey:"h_gas"}],["HELMET",{armor:1,fov:90,textureKey:"h_helmet"}],["NIGHT_VISION",{armor:0,fov:90,textureKey:"h_night"}]])},function(e,t,n){"use strict";n.r(t),n.d(t,"Weapon",function(){return r}),n.d(t,"WeaponEnum",function(){return o});var r=function(){function e(e,t,n,r,o,i,a,s){this.fireRate=e,this.damage=t,this.spread=n,this.range=r,this.textureKey=o,this.bodyType=i,this.x=a,this.y=s}return e.makeWeapon=function(t,n){var r=new e(t.fireRate,t.damage,t.spread,t.range,t.textureKey,t.bodyType,t.x,t.y);return r._sprite=n.add.sprite(r.x,r.y,r.textureKey),r},Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),e}(),o=new Map([["PISTOL",{fireRate:2,damage:15,spread:5,range:1e3,textureKey:"w_pistol",bodyType:1,x:20,y:0}],["SILENCED_PISTOL",{fireRate:2,damage:10,spread:0,range:1e3,textureKey:"w_suppressed_pistol",bodyType:1,x:20,y:0}],["UZI",{fireRate:4,damage:10,spread:30,range:1500,textureKey:"w_uzi",bodyType:1,x:20,y:0}],["ASSAULT_RIFLE",{fireRate:3,damage:10,spread:8,range:2e3,textureKey:"w_assault_rifle",bodyType:0,x:20,y:0}],["SHOTGUN",{fireRate:1,damage:15,spread:30,range:750,textureKey:"w_shotgun",bodyType:0,x:20,y:0}],["TASER",{fireRate:1,damage:0,spread:2,range:250,textureKey:"w_taser",bodyType:1,x:20,y:0}],["GAS_MARKER",{fireRate:2,damage:0,spread:8,range:2e3,textureKey:"w_gas_marker",bodyType:0,x:20,y:0}]])},function(e,t,n){"use strict";n.r(t),n.d(t,"Raycaster",function(){return r});var r=function(){function e(e){this.map=e}return e.prototype.generateIntersectionPoints=function(t,n,r,o){var i=this,a=this.map.points,s=[r-o/2,r+o/2],u=[{x:t,y:n,param:0,angle:-1/0}];return s.forEach(function(r){var o=e.makeRay(t,n,r),a=i.getClosestIntersection(o);null!==a&&(a.angle=r,u.push(a))}),a.forEach(function(r){var o=Math.PI+Phaser.Math.Angle.Between(r.x,r.y,t,n),a=2*Math.PI;if(o>a+s[0]&&o<a+s[1]||o>s[0]&&o<s[1])for(var d=-1;d<2;d++){var c=o+1e-5*d,p=e.makeRay(t,n,c),h=i.getClosestIntersection(p);null!==h&&(h.angle=c,u.push(h))}}),u.sort(function(e,t){return Phaser.Math.Angle.Normalize(Phaser.Math.Angle.Normalize(e.angle)-r+o)-Phaser.Math.Angle.Normalize(Phaser.Math.Angle.Normalize(t.angle)-r+o)})},e.prototype.getClosestIntersection=function(t){var n=null;return this.map.segments.forEach(function(r){var o=e.getIntersection(t,r);o&&(!n||o.param<n.param)&&(n=o)}),n},e.getIntersection=function(e,t){if(e.dx/e.mag==t.dx/t.mag&&e.dy/e.mag==t.dy/t.mag)return null;var n=(e.dx*(t.y-e.y)+e.dy*(e.x-t.x))/(t.dx*e.dy-t.dy*e.dx);if(n<0||n>1)return null;var r=(t.x+t.dx*n-e.x)/e.dx;return r<0?null:{x:e.x+e.dx*r,y:e.y+e.dy*r,param:r,angle:-1/0}},e.makeRay=function(e,t,n){return{x:e,y:t,mag:1,dx:Math.cos(n),dy:Math.sin(n)}},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Player",function(){return a});var r=n(0),o=n(1),i=n(2),a=function(){function e(e,t,n,a){this.scene=e,this.angle=0,this.baseSpeed=300,this.body=r.Body.makeBody(r.BodyEnum.get("LIGHT"),e),this.weapon=i.Weapon.makeWeapon(i.WeaponEnum.get("ASSAULT_RIFLE"),e),this.head=o.Head.makeHead(o.HeadEnum.get("NIGHT_VISION"),e),this._container=e.add.container(t,n),this._container.add([this.body.sprite,this.weapon.sprite,this.head.sprite]).setDepth(100),e.physics.world.enableBody(this._container),this.containerBody.setCircle(36,-36,-36).setCollideWorldBounds(!0),this.raycaster=a,this.makeRaycast()}return e.prototype.update=function(e,t,n,r,o,i){this.modifyAngle(o,i),this.modifyPosition(e,t,n,r),this.fovPolygon.destroy(),this.makeRaycast()},e.prototype.modifyPosition=function(e,t,n,r){r&&!t?this.containerBody.setVelocityX(this.speed):t&&!r?this.containerBody.setVelocityX(-this.speed):this.containerBody.setVelocityX(0),n&&!e?this.containerBody.setVelocityY(this.speed):e&&!n?this.containerBody.setVelocityY(-this.speed):this.containerBody.setVelocityY(0)},e.prototype.modifyAngle=function(e,t){this.angle=Phaser.Math.Angle.Between(this._container.x+this.scene.cameraProps.offset,this._container.y+0,e,t),this._container.setRotation(this.angle)},e.prototype.makeRaycast=function(){var e=this.raycaster.generateIntersectionPoints(this._container.x,this._container.y,this.angle,this.fov);this.fovPolygon=this.scene.add.polygon(0,0,e,16777215,.3).setOrigin(0)},Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"containerBody",{get:function(){return this._container.body},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this.head.fov/180*Math.PI},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this.baseSpeed*this.body.speedModifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armor",{get:function(){return this.body.armor+this.head.armor},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"GameMap",function(){return r});var r=function(){function e(e,t){var n=this;this._map=new Map,this._points=[{x:e.boundX,y:e.boundY},{x:e.boundX+e.boundW,y:e.boundY},{x:e.boundX+e.boundW,y:e.boundY+e.boundH},{x:e.boundX,y:e.boundY+e.boundH}],this._segments=[{x:e.boundX,y:e.boundY,dx:e.boundW,dy:0,mag:e.boundW},{x:e.boundX+e.boundW,y:e.boundY,dx:0,dy:e.boundH,mag:e.boundH},{x:e.boundX+e.boundW,y:e.boundY+e.boundH,dx:-e.boundW,dy:0,mag:e.boundW},{x:e.boundX,y:e.boundY+e.boundH,dx:0,dy:-e.boundH,mag:e.boundH}],Object.keys(t).forEach(function(r){n._map[r]=e.physics.add.staticGroup(),t[r].forEach(function(t){var o=Number.parseInt(t.fill,16),i=Number.parseFloat(t.fillOpacity)||1,a=Number.parseInt(t.x,10)+e.boundX,s=Number.parseInt(t.y,10)+e.boundY,u=Number.parseInt(t.width,10),d=Number.parseInt(t.height,10),c=e.add.rectangle(a,s,u,d,o,i).setOrigin(0);n._map[r].add(c),"wn"!==r&&(n._points.push({x:a,y:s},{x:a+u,y:s},{x:a+u,y:s+d},{x:a,y:s+d}),n._segments.push({x:a,y:s,dx:u,dy:0,mag:u},{x:a+u,y:s,dx:0,dy:d,mag:d},{x:a+u,y:s+d,dx:-u,dy:0,mag:u},{x:a,y:s+d,dx:0,dy:-d,mag:d}))})}),this._points.sort(function(e,t){return e.x-t.x||e.y-t.y});var r=[this._points[0]];this._points.forEach(function(e){var t=r[r.length-1];t.x===e.x&&t.y===e.y||r.push(e)}),this._points=r}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segments",{get:function(){return this._segments},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"MainScene",function(){return s});var r=n(5),o=n(4),i=n(3),a=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(e){function t(){var t=this,n=window.innerHeight,r=(window.innerWidth-window.innerHeight)/2;return(t=e.call(this,{key:"main",active:!0,physics:{default:"arcade",arcade:{}}})||this).viewportSize={height:window.innerHeight,width:window.innerWidth},t.cameraProps={size:n,offset:r,zoom:Math.round(n/70)/10,lerp:1,minimapCoefficient:r/n},t.boundX=-900,t.boundY=-600,t.boundW=-2*t.boundX,t.boundH=-2*t.boundY,t}return a(t,e),t.prototype.preload=function(){var e=this;this.load.setBaseURL("http://localhost:3000/assets");var t=this.make.text({x:this.viewportSize.width/2,y:this.viewportSize.height/2-25,text:"Loading...",style:{font:"20px monospace",fill:"#ffffff"}}).setOrigin(.5,.5),n=this.make.text({x:this.viewportSize.width/2,y:this.viewportSize.height/2+5,text:"",style:{font:"18px monospace",fill:"#ffffff"}}).setOrigin(.5,.5);this.load.on("progress",function(e){t.setText("Loading: "+Math.round(1e4*e)/100)}),this.load.on("fileprogress",function(e){n.setText("Loading asset: .../"+e.url)}),this.load.on("complete",function(){t.destroy(),n.destroy()});var r={svg:{body:["b_heavy_1","b_heavy_2","b_light_1","b_light_2","b_none_1","b_none_2"],head:["h_gas","h_helmet","h_night","h_none"],weapon:["w_assault_rifle","w_gas_marker","w_pistol","w_shotgun","w_suppressed_pistol","w_taser","w_uzi"]},json:{maps:["1"]}};Object.keys(r).forEach(function(t){Object.keys(r[t]).forEach(function(n){r[t][n].forEach(function(r){e.load[t](""+r,n+"/"+r+"."+t)})})})},t.prototype.create=function(){var e=this;this.controls={w:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),a:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),s:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),d:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),cursorX:0,cursorY:0},this.map=new r.GameMap(this,this.cache.json.get("1")),this.physics.world.setBounds(this.boundX,this.boundY,this.boundW,this.boundH,!0,!0,!0,!0),this.player=new o.Player(this,0,0,new i.Raycaster(this.map));var t=function(t){n.physics.world.addCollider(function(){return e.player.container},function(){return e.map.map.get(t)})},n=this;for(var a in this.map.map.keys())t(a);this.maincam=this.cameras.main,this.setupMainCamera(),this.minimap=this.cameras.add(),this.setupMinimap(),this.input.on("pointermove",function(e){this.controls.cursorX=e.x,this.controls.cursorY=e.y},this)},t.prototype.update=function(){this.player.update(this.controls.w.isDown,this.controls.a.isDown,this.controls.s.isDown,this.controls.d.isDown,this.controls.cursorX+this.cameras.main.scrollX,this.controls.cursorY+this.cameras.main.scrollY)},t.prototype.setupMainCamera=function(){this.maincam.startFollow(this.player.container,!1,this.cameraProps.lerp).setName("main").setZoom(this.cameraProps.zoom).setBounds(this.boundX,this.boundY,this.boundW,this.boundH).setSize(this.cameraProps.size,this.cameraProps.size).setPosition(this.cameraProps.offset,0)},t.prototype.setupMinimap=function(){var e=this.cameraProps.minimapCoefficient;this.minimap.startFollow(this.player.container,!1,this.cameraProps.lerp).setName("mini").setZoom(e*this.cameraProps.zoom).setBounds(this.boundX,this.boundY,this.boundW,this.boundH).setSize(e*this.cameraProps.size,e*this.cameraProps.size).setPosition(window.innerWidth-this.cameraProps.offset,0).setBackgroundColor(8772)},t}(Phaser.Scene)},function(e,t,n){n(0),n(1),n(2),n(3),n(4),n(5),n(6),e.exports=n(8)},function(e,t,n){"use strict";n.r(t);var r=n(6);window.onload=function(){var e={type:Phaser.AUTO,width:document.body.scrollWidth,height:document.body.scrollHeight,backgroundColor:"#000000",scene:[r.MainScene],fps:{min:30,target:60}};new Phaser.Game(e)}}]);